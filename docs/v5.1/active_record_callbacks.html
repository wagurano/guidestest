<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Active Record Callbacks — Ruby on Rails Guides</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div>
    <img src="images/edge_badge.png" alt="edge-badge" id="edge-badge" />
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">더보기 <a href="http://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        루비 온 레일스
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://weblog.rubyonrails.org/">블로그</a></li>
        <li class="more-info"><a href="http://guides.rubyonrails.org/">가이드(영어)</a></li>
        <li class="more-info"><a href="http://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="http://stackoverflow.com/questions/tagged/ruby-on-rails">물어보기</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">레일스 저장소</a></li>
        <li class="more-info"><a href="https://github.com/rorlakr/rails-guides">번역 저장소</a></li>
        <li class="more-info"><a href="http://rorlab.org">RORLAB</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="홈페이지로 돌아가기">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">홈</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">가이드 목차</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>시작하기 전에</dt>
                <dd><a href="getting_started.html">레일스 시작하기</a></dd>
                <dt>모델</dt>
                <dd><a href="active_record_basics.html">액티브 레코드 기본</a></dd>
                <dd><a href="active_record_migrations.html">액티브 레코드 마이그레이션</a></dd>
                <dd><a href="active_record_validations.html">액티브 레코드 밸리데이션</a></dd>
                <dd><a href="active_record_callbacks.html">액티브 레코드 콜백</a></dd>
                <dd><a href="association_basics.html">액티브 레코드 관계</a></dd>
                <dd><a href="active_record_querying.html">액티브 레코드 검색 인터페이스</a></dd>
                <dt>뷰</dt>
                <dd><a href="layouts_and_rendering.html">레일스의 레이아웃과 렌더링</a></dd>
                <dd><a href="form_helpers.html">액션 뷰 폼 헬퍼</a></dd>
                <dt>콘트롤러</dt>
                <dd><a href="action_controller_overview.html">액션 콘트롤러 개요</a></dd>
                <dd><a href="routing.html">레일스 라우팅</a></dd>
              </dl>
              <dl class="R">
                <dt>심화 내용</dt>
                <dd><a href="active_support_core_extensions.html">액티브 서포트 코어 확장</a></dd>
                <dd><a href="i18n.html">레일스 다국어 API</a></dd>
                <dd><a href="action_mailer_basics.html">액션 메일러 기본</a></dd>
                <dd><a href="active_job_basics.html">액티브 잡 기본</a></dd>
                <dd><a href="testing.html">레일스 애플리케이션 테스트</a></dd>
                <dd><a href="security.html">레일스 애플리케이션 보안</a></dd>
                <dd><a href="debugging_rails_applications.html">레일스 애플리케이션 디버깅</a></dd>
                <dd><a href="configuring.html">레일스 애플리케이션 설정</a></dd>
                <dd><a href="command_line.html">레일스 콘솔 명령어</a></dd>
                <dd><a href="asset_pipeline.html">애셋 파이프라인</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">레일스에서 자바스크립트 사용하는 방법</a></dd>
                <dd><a href="autoloading_and_reloading_constants.html">상수를 자동으로 가져오고 다시 불러오는 기능</a></dd>
                <dd><a href="caching_with_rails.html">레일스로 캐싱하기: 개요</a></dd>
                <dd><a href="api_app.html">API만 사용하는 레일스 애플리케이션</a></dd>
                <dd><a href="action_cable_overview.html">액션 케이블 소개</a></dd>
                <dt>레일스 확장하기</dt>
                <dd><a href="rails_on_rack.html">레일스 온 랙</a></dd>
                <dd><a href="generators.html">레일스 제너레이터 만드는 방법</a></dd>
                <dt>루비 온 레일스에 기여하는 방법</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">루비 온 레일스에 기여하는 방법</a></dd>
                <dd><a href="api_documentation_guidelines.html">API 문서 작성 지침</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">루비 온 레일스 가이드 지침</a></dd>
                <dt>유지관리 정책</dt>
                <dd><a href="maintenance_policy.html">유지관리 정책</a></dd>
                <dt>릴리스 노트</dt>
                <dd><a href="upgrading_ruby_on_rails.html">루비 온 레일스 업그레이드 가이드</a></dd>
                <dd><a href="5_1_release_notes.html">루비 온 레일스 5.1 릴리스 노트</a></dd>
                <dd><a href="5_0_release_notes.html">루비 온 레일스 5.0 릴리스 노트</a></dd>
                <dd><a href="4_2_release_notes.html">루비 온 레일스 4.2 릴리스 노트</a></dd>
                <dd><a href="4_1_release_notes.html">루비 온 레일스 4.1 릴리스 노트</a></dd>
                <dd><a href="4_0_release_notes.html">루비 온 레일스 4.0 릴리스 노트</a></dd>
                <dd><a href="3_2_release_notes.html">루비 온 레일스 3.2 릴리스 노트</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes</a></dd>
                <dd><a href="3_0_release_notes.html">루비 온 레일스 3.0 릴리스 노트</a></dd>
                <dd><a href="2_3_release_notes.html">루비 온 레일스 2.3 릴리스 노트</a></dd>
                <dd><a href="2_2_release_notes.html">루비 온 레일스 2.2 릴리스 노트</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">기여하기</a></li>
        <li><a class="nav-item" href="credits.html">도와주신 분들</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">가이드 목차</option>
              <optgroup label="시작하기 전에">
                  <option value="getting_started.html">레일스 시작하기</option>
              </optgroup>
              <optgroup label="모델">
                  <option value="active_record_basics.html">액티브 레코드 기본</option>
                  <option value="active_record_migrations.html">액티브 레코드 마이그레이션</option>
                  <option value="active_record_validations.html">액티브 레코드 밸리데이션</option>
                  <option value="active_record_callbacks.html">액티브 레코드 콜백</option>
                  <option value="association_basics.html">액티브 레코드 관계</option>
                  <option value="active_record_querying.html">액티브 레코드 검색 인터페이스</option>
              </optgroup>
              <optgroup label="뷰">
                  <option value="layouts_and_rendering.html">레일스의 레이아웃과 렌더링</option>
                  <option value="form_helpers.html">액션 뷰 폼 헬퍼</option>
              </optgroup>
              <optgroup label="콘트롤러">
                  <option value="action_controller_overview.html">액션 콘트롤러 개요</option>
                  <option value="routing.html">레일스 라우팅</option>
              </optgroup>
              <optgroup label="심화 내용">
                  <option value="active_support_core_extensions.html">액티브 서포트 코어 확장</option>
                  <option value="i18n.html">레일스 다국어 API</option>
                  <option value="action_mailer_basics.html">액션 메일러 기본</option>
                  <option value="active_job_basics.html">액티브 잡 기본</option>
                  <option value="testing.html">레일스 애플리케이션 테스트</option>
                  <option value="security.html">레일스 애플리케이션 보안</option>
                  <option value="debugging_rails_applications.html">레일스 애플리케이션 디버깅</option>
                  <option value="configuring.html">레일스 애플리케이션 설정</option>
                  <option value="command_line.html">레일스 콘솔 명령어</option>
                  <option value="asset_pipeline.html">애셋 파이프라인</option>
                  <option value="working_with_javascript_in_rails.html">레일스에서 자바스크립트 사용하는 방법</option>
                  <option value="autoloading_and_reloading_constants.html">상수를 자동으로 가져오고 다시 불러오는 기능</option>
                  <option value="caching_with_rails.html">레일스로 캐싱하기: 개요</option>
                  <option value="api_app.html">API만 사용하는 레일스 애플리케이션</option>
                  <option value="action_cable_overview.html">액션 케이블 소개</option>
              </optgroup>
              <optgroup label="레일스 확장하기">
                  <option value="rails_on_rack.html">레일스 온 랙</option>
                  <option value="generators.html">레일스 제너레이터 만드는 방법</option>
              </optgroup>
              <optgroup label="루비 온 레일스에 기여하는 방법">
                  <option value="contributing_to_ruby_on_rails.html">루비 온 레일스에 기여하는 방법</option>
                  <option value="api_documentation_guidelines.html">API 문서 작성 지침</option>
                  <option value="ruby_on_rails_guides_guidelines.html">루비 온 레일스 가이드 지침</option>
              </optgroup>
              <optgroup label="유지관리 정책">
                  <option value="maintenance_policy.html">유지관리 정책</option>
              </optgroup>
              <optgroup label="릴리스 노트">
                  <option value="upgrading_ruby_on_rails.html">루비 온 레일스 업그레이드 가이드</option>
                  <option value="5_1_release_notes.html">루비 온 레일스 5.1 릴리스 노트</option>
                  <option value="5_0_release_notes.html">루비 온 레일스 5.0 릴리스 노트</option>
                  <option value="4_2_release_notes.html">루비 온 레일스 4.2 릴리스 노트</option>
                  <option value="4_1_release_notes.html">루비 온 레일스 4.1 릴리스 노트</option>
                  <option value="4_0_release_notes.html">루비 온 레일스 4.0 릴리스 노트</option>
                  <option value="3_2_release_notes.html">루비 온 레일스 3.2 릴리스 노트</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes</option>
                  <option value="3_0_release_notes.html">루비 온 레일스 3.0 릴리스 노트</option>
                  <option value="2_3_release_notes.html">루비 온 레일스 2.3 릴리스 노트</option>
                  <option value="2_2_release_notes.html">루비 온 레일스 2.2 릴리스 노트</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Active Record Callbacks</h2><p>This guide teaches you how to hook into the life cycle of your Active Record
objects.</p><p>After reading this guide, you will know:</p>
<ul>
<li>The life cycle of Active Record objects.</li>
<li>How to create callback methods that respond to events in the object life cycle.</li>
<li>How to create special classes that encapsulate common behavior for your callbacks.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#the-object-life-cycle">The Object Life Cycle</a></li>
<li>
<a href="#callbacks-overview">Callbacks Overview</a>

<ul>
<li><a href="#callback-registration">Callback Registration</a></li>
</ul>
</li>
<li>
<a href="#available-callbacks">Available Callbacks</a>

<ul>
<li><a href="#creating-an-object">Creating an Object</a></li>
<li><a href="#updating-an-object">Updating an Object</a></li>
<li><a href="#destroying-an-object">Destroying an Object</a></li>
<li><a href="#after-initialize-and-after-find"><code>after_initialize</code> and <code>after_find</code></a></li>
<li><a href="#after-touch"><code>after_touch</code></a></li>
</ul>
</li>
<li><a href="#running-callbacks">Running Callbacks</a></li>
<li><a href="#skipping-callbacks">Skipping Callbacks</a></li>
<li><a href="#halting-execution">Halting Execution</a></li>
<li><a href="#relational-callbacks">Relational Callbacks</a></li>
<li>
<a href="#conditional-callbacks">Conditional Callbacks</a>

<ul>
<li><a href="#using-if-and-unless-with-a-symbol">Using <code>:if</code> and <code>:unless</code> with a <code>Symbol</code></a></li>
<li><a href="#using-if-and-unless-with-a-proc">Using <code>:if</code> and <code>:unless</code> with a <code>Proc</code></a></li>
<li><a href="#multiple-conditions-for-callbacks">Multiple Conditions for Callbacks</a></li>
</ul>
</li>
<li><a href="#callback-classes">Callback Classes</a></li>
<li><a href="#transaction-callbacks">Transaction Callbacks</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="the-object-life-cycle">1 The Object Life Cycle</h3><p>During the normal operation of a Rails application, objects may be created, updated, and destroyed. Active Record provides hooks into this <em>object life cycle</em> so that you can control your application and its data.</p><p>Callbacks allow you to trigger logic before or after an alteration of an object's state.</p><h3 id="callbacks-overview">2 Callbacks Overview</h3><p>Callbacks are methods that get called at certain moments of an object's life cycle. With callbacks it is possible to write code that will run whenever an Active Record object is created, saved, updated, deleted, validated, or loaded from the database.</p><h4 id="callback-registration">2.1 Callback Registration</h4><p>In order to use the available callbacks, you need to register them. You can implement the callbacks as ordinary methods and use a macro-style class method to register them as callbacks:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ApplicationRecord
  validates :login, :email, presence: true

  before_validation :ensure_login_has_a_value

  private
    def ensure_login_has_a_value
      if login.nil?
        self.login = email unless email.blank?
      end
    end
end

</pre>
</div>
<p>The macro-style class methods can also receive a block. Consider using this style if the code inside your block is so short that it fits in a single line:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ApplicationRecord
  validates :login, :email, presence: true

  before_create do
    self.name = login.capitalize if name.blank?
  end
end

</pre>
</div>
<p>Callbacks can also be registered to only fire on certain life cycle events:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ApplicationRecord
  before_validation :normalize_name, on: :create

  # :on takes an array as well
  after_validation :set_location, on: [ :create, :update ]

  private
    def normalize_name
      self.name = name.downcase.titleize
    end

    def set_location
      self.location = LocationService.query(self)
    end
end

</pre>
</div>
<p>It is considered good practice to declare callback methods as private. If left public, they can be called from outside of the model and violate the principle of object encapsulation.</p><h3 id="available-callbacks">3 Available Callbacks</h3><p>Here is a list with all the available Active Record callbacks, listed in the same order in which they will get called during the respective operations:</p><h4 id="creating-an-object">3.1 Creating an Object</h4>
<ul>
<li><code>before_validation</code></li>
<li><code>after_validation</code></li>
<li><code>before_save</code></li>
<li><code>around_save</code></li>
<li><code>before_create</code></li>
<li><code>around_create</code></li>
<li><code>after_create</code></li>
<li><code>after_save</code></li>
<li><code>after_commit/after_rollback</code></li>
</ul>
<h4 id="updating-an-object">3.2 Updating an Object</h4>
<ul>
<li><code>before_validation</code></li>
<li><code>after_validation</code></li>
<li><code>before_save</code></li>
<li><code>around_save</code></li>
<li><code>before_update</code></li>
<li><code>around_update</code></li>
<li><code>after_update</code></li>
<li><code>after_save</code></li>
<li><code>after_commit/after_rollback</code></li>
</ul>
<h4 id="destroying-an-object">3.3 Destroying an Object</h4>
<ul>
<li><code>before_destroy</code></li>
<li><code>around_destroy</code></li>
<li><code>after_destroy</code></li>
<li><code>after_commit/after_rollback</code></li>
</ul>
<div class="warning"><p><code>after_save</code> runs both on create and update, but always <em>after</em> the more specific callbacks <code>after_create</code> and <code>after_update</code>, no matter the order in which the macro calls were executed.</p></div><h4 id="after-initialize-and-after-find">3.4 <code>after_initialize</code> and <code>after_find</code>
</h4><p>The <code>after_initialize</code> callback will be called whenever an Active Record object is instantiated, either by directly using <code>new</code> or when a record is loaded from the database. It can be useful to avoid the need to directly override your Active Record <code>initialize</code> method.</p><p>The <code>after_find</code> callback will be called whenever Active Record loads a record from the database. <code>after_find</code> is called before <code>after_initialize</code> if both are defined.</p><p>The <code>after_initialize</code> and <code>after_find</code> callbacks have no <code>before_*</code> counterparts, but they can be registered just like the other Active Record callbacks.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ApplicationRecord
  after_initialize do |user|
    puts "You have initialized an object!"
  end

  after_find do |user|
    puts "You have found an object!"
  end
end

&gt;&gt; User.new
You have initialized an object!
=&gt; #&lt;User id: nil&gt;

&gt;&gt; User.first
You have found an object!
You have initialized an object!
=&gt; #&lt;User id: 1&gt;

</pre>
</div>
<h4 id="after-touch">3.5 <code>after_touch</code>
</h4><p>The <code>after_touch</code> callback will be called whenever an Active Record object is touched.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ApplicationRecord
  after_touch do |user|
    puts "You have touched an object"
  end
end

&gt;&gt; u = User.create(name: 'Kuldeep')
=&gt; #&lt;User id: 1, name: "Kuldeep", created_at: "2013-11-25 12:17:49", updated_at: "2013-11-25 12:17:49"&gt;

&gt;&gt; u.touch
You have touched an object
=&gt; true

</pre>
</div>
<p>It can be used along with <code>belongs_to</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Employee &lt; ApplicationRecord
  belongs_to :company, touch: true
  after_touch do
    puts 'An Employee was touched'
  end
end

class Company &lt; ApplicationRecord
  has_many :employees
  after_touch :log_when_employees_or_company_touched

  private
  def log_when_employees_or_company_touched
    puts 'Employee/Company was touched'
  end
end

&gt;&gt; @employee = Employee.last
=&gt; #&lt;Employee id: 1, company_id: 1, created_at: "2013-11-25 17:04:22", updated_at: "2013-11-25 17:05:05"&gt;

# triggers @employee.company.touch
&gt;&gt; @employee.touch
Employee/Company was touched
An Employee was touched
=&gt; true

</pre>
</div>
<h3 id="running-callbacks">4 Running Callbacks</h3><p>The following methods trigger callbacks:</p>
<ul>
<li><code>create</code></li>
<li><code>create!</code></li>
<li><code>destroy</code></li>
<li><code>destroy!</code></li>
<li><code>destroy_all</code></li>
<li><code>save</code></li>
<li><code>save!</code></li>
<li><code>save(validate: false)</code></li>
<li><code>toggle!</code></li>
<li><code>update_attribute</code></li>
<li><code>update</code></li>
<li><code>update!</code></li>
<li><code>valid?</code></li>
</ul>
<p>Additionally, the <code>after_find</code> callback is triggered by the following finder methods:</p>
<ul>
<li><code>all</code></li>
<li><code>first</code></li>
<li><code>find</code></li>
<li><code>find_by</code></li>
<li><code>find_by_*</code></li>
<li><code>find_by_*!</code></li>
<li><code>find_by_sql</code></li>
<li><code>last</code></li>
</ul>
<p>The <code>after_initialize</code> callback is triggered every time a new object of the class is initialized.</p><div class="note"><p>The <code>find_by_*</code> and <code>find_by_*!</code> methods are dynamic finders generated automatically for every attribute. Learn more about them at the <a href="active_record_querying.html#dynamic-finders">Dynamic finders section</a></p></div><h3 id="skipping-callbacks">5 Skipping Callbacks</h3><p>Just as with validations, it is also possible to skip callbacks by using the following methods:</p>
<ul>
<li><code>decrement</code></li>
<li><code>decrement_counter</code></li>
<li><code>delete</code></li>
<li><code>delete_all</code></li>
<li><code>increment</code></li>
<li><code>increment_counter</code></li>
<li><code>toggle</code></li>
<li><code>touch</code></li>
<li><code>update_column</code></li>
<li><code>update_columns</code></li>
<li><code>update_all</code></li>
<li><code>update_counters</code></li>
</ul>
<p>These methods should be used with caution, however, because important business rules and application logic may be kept in callbacks. Bypassing them without understanding the potential implications may lead to invalid data.</p><h3 id="halting-execution">6 Halting Execution</h3><p>As you start registering new callbacks for your models, they will be queued for execution. This queue will include all your model's validations, the registered callbacks, and the database operation to be executed.</p><p>The whole callback chain is wrapped in a transaction. If any callback raises an exception, the execution chain gets halted and a ROLLBACK is issued. To intentionally stop a chain use:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
throw :abort

</pre>
</div>
<div class="warning"><p>Any exception that is not <code>ActiveRecord::Rollback</code> or <code>ActiveRecord::RecordInvalid</code> will be re-raised by Rails after the callback chain is halted. Raising an exception other than <code>ActiveRecord::Rollback</code> or <code>ActiveRecord::RecordInvalid</code> may break code that does not expect methods like <code>save</code> and <code>update_attributes</code> (which normally try to return <code>true</code> or <code>false</code>) to raise an exception.</p></div><h3 id="relational-callbacks">7 Relational Callbacks</h3><p>Callbacks work through model relationships, and can even be defined by them. Suppose an example where a user has many articles. A user's articles should be destroyed if the user is destroyed. Let's add an <code>after_destroy</code> callback to the <code>User</code> model by way of its relationship to the <code>Article</code> model:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ApplicationRecord
  has_many :articles, dependent: :destroy
end

class Article &lt; ApplicationRecord
  after_destroy :log_destroy_action

  def log_destroy_action
    puts 'Article destroyed'
  end
end

&gt;&gt; user = User.first
=&gt; #&lt;User id: 1&gt;
&gt;&gt; user.articles.create!
=&gt; #&lt;Article id: 1, user_id: 1&gt;
&gt;&gt; user.destroy
Article destroyed
=&gt; #&lt;User id: 1&gt;

</pre>
</div>
<h3 id="conditional-callbacks">8 Conditional Callbacks</h3><p>As with validations, we can also make the calling of a callback method conditional on the satisfaction of a given predicate. We can do this using the <code>:if</code> and <code>:unless</code> options, which can take a symbol, a <code>Proc</code> or an <code>Array</code>. You may use the <code>:if</code> option when you want to specify under which conditions the callback <strong>should</strong> be called. If you want to specify the conditions under which the callback <strong>should not</strong> be called, then you may use the <code>:unless</code> option.</p><h4 id="using-if-and-unless-with-a-symbol">8.1 Using <code>:if</code> and <code>:unless</code> with a <code>Symbol</code>
</h4><p>You can associate the <code>:if</code> and <code>:unless</code> options with a symbol corresponding to the name of a predicate method that will get called right before the callback. When using the <code>:if</code> option, the callback won't be executed if the predicate method returns false; when using the <code>:unless</code> option, the callback won't be executed if the predicate method returns true. This is the most common option. Using this form of registration it is also possible to register several different predicates that should be called to check if the callback should be executed.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ApplicationRecord
  before_save :normalize_card_number, if: :paid_with_card?
end

</pre>
</div>
<h4 id="using-if-and-unless-with-a-proc">8.2 Using <code>:if</code> and <code>:unless</code> with a <code>Proc</code>
</h4><p>Finally, it is possible to associate <code>:if</code> and <code>:unless</code> with a <code>Proc</code> object. This option is best suited when writing short validation methods, usually one-liners:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ApplicationRecord
  before_save :normalize_card_number,
    if: Proc.new { |order| order.paid_with_card? }
end

</pre>
</div>
<h4 id="multiple-conditions-for-callbacks">8.3 Multiple Conditions for Callbacks</h4><p>When writing conditional callbacks, it is possible to mix both <code>:if</code> and <code>:unless</code> in the same callback declaration:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Comment &lt; ApplicationRecord
  after_create :send_email_to_author, if: :author_wants_emails?,
    unless: Proc.new { |comment| comment.article.ignore_comments? }
end

</pre>
</div>
<h3 id="callback-classes">9 Callback Classes</h3><p>Sometimes the callback methods that you'll write will be useful enough to be reused by other models. Active Record makes it possible to create classes that encapsulate the callback methods, so it becomes very easy to reuse them.</p><p>Here's an example where we create a class with an <code>after_destroy</code> callback for a <code>PictureFile</code> model:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PictureFileCallbacks
  def after_destroy(picture_file)
    if File.exist?(picture_file.filepath)
      File.delete(picture_file.filepath)
    end
  end
end

</pre>
</div>
<p>When declared inside a class, as above, the callback methods will receive the model object as a parameter. We can now use the callback class in the model:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PictureFile &lt; ApplicationRecord
  after_destroy PictureFileCallbacks.new
end

</pre>
</div>
<p>Note that we needed to instantiate a new <code>PictureFileCallbacks</code> object, since we declared our callback as an instance method. This is particularly useful if the callbacks make use of the state of the instantiated object. Often, however, it will make more sense to declare the callbacks as class methods:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PictureFileCallbacks
  def self.after_destroy(picture_file)
    if File.exist?(picture_file.filepath)
      File.delete(picture_file.filepath)
    end
  end
end

</pre>
</div>
<p>If the callback method is declared this way, it won't be necessary to instantiate a <code>PictureFileCallbacks</code> object.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PictureFile &lt; ApplicationRecord
  after_destroy PictureFileCallbacks
end

</pre>
</div>
<p>You can declare as many callbacks as you want inside your callback classes.</p><h3 id="transaction-callbacks">10 Transaction Callbacks</h3><p>There are two additional callbacks that are triggered by the completion of a database transaction: <code>after_commit</code> and <code>after_rollback</code>. These callbacks are very similar to the <code>after_save</code> callback except that they don't execute until after database changes have either been committed or rolled back. They are most useful when your active record models need to interact with external systems which are not part of the database transaction.</p><p>Consider, for example, the previous example where the <code>PictureFile</code> model needs to delete a file after the corresponding record is destroyed. If anything raises an exception after the <code>after_destroy</code> callback is called and the transaction rolls back, the file will have been deleted and the model will be left in an inconsistent state. For example, suppose that <code>picture_file_2</code> in the code below is not valid and the <code>save!</code> method raises an error.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
PictureFile.transaction do
  picture_file_1.destroy
  picture_file_2.save!
end

</pre>
</div>
<p>By using the <code>after_commit</code> callback we can account for this case.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PictureFile &lt; ApplicationRecord
  after_commit :delete_picture_file_from_disk, on: :destroy

  def delete_picture_file_from_disk
    if File.exist?(filepath)
      File.delete(filepath)
    end
  end
end

</pre>
</div>
<div class="note"><p>The <code>:on</code> option specifies when a callback will be fired. If you
don't supply the <code>:on</code> option the callback will fire for every action.</p></div><p>Since using <code>after_commit</code> callback only on create, update or delete is
common, there are aliases for those operations:</p>
<ul>
<li><code>after_create_commit</code></li>
<li><code>after_update_commit</code></li>
<li><code>after_destroy_commit</code></li>
</ul>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PictureFile &lt; ApplicationRecord
  after_destroy_commit :delete_picture_file_from_disk

  def delete_picture_file_from_disk
    if File.exist?(filepath)
      File.delete(filepath)
    end
  end
end

</pre>
</div>
<div class="warning"><p>The <code>after_commit</code> and <code>after_rollback</code> callbacks are called for all models created, updated, or destroyed within a transaction block. However, if an exception is raised within one of these callbacks, the exception will bubble up and any remaining <code>after_commit</code> or <code>after_rollback</code> methods will <em>not</em> be executed. As such, if your callback code could raise an exception, you'll need to rescue it and handle it within the callback in order to allow other callbacks to run.</p></div>

        <h3>피드백</h3>
        <p>
          여러분의 참여가 가이드 수준을 높입니다.
        </p>
        <p>
          오자와 탈자 또는 확인할 수 있는 에러를 발견하면 기여해보기를 바랍니다.
          기여하기 전에, <a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">문서 기여 방법</a> 부분을 읽기 바랍니다.
        </p>
        <p>
          내용이 부족하거나 최신 글이 아닐 수도 있습니다.
          마스터 브랜치에 빠진 문서를 넣어주기를 바랍니다. 먼저 
          <a href="http://edgeguides.rubyonrails.org">엣지 가이드</a>에서 
          해당 이슈를 이미 수정하여 마스터 브랜치에 반영하였는지 확인하기 바랍니다.
          <a href="ruby_on_rails_guides_guidelines.html">루비 온 레일스 가이드 지침</a>에서 
          스타일과 관례를 확인합니다.
        </p>
        <p>
          고쳐야 할 것을 찾았으나 직접 수정할 수 없다면,
          <a href="https://github.com/rails/rails/issues">이슈로 올리기</a> 바랍니다.
        </p>
        <p>그리고 마지막으로, 루비 온 레일스 문서에 대한 어떤 토론이라도 <a href="https://groups.google.com/forum/#!forum/rubyonrails-docs">rubyonrails-docs 메일링 리스트</a>에서 환영합니다.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>이 저작물은 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.ko">크리에이티브 커먼즈 동일조건변경허락 4.0 국제</a> 라이선스를 따릅니다.</p>
<p>"Rails" 와 "Ruby on Rails" 와 레일스 로고의 저작권은 데이비드 하이네마이어 한슨에게 있습니다.</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter.js"></script>
  <script type="text/javascript">
    syntaxhighlighterConfig = {
      autoLinks: false,
    };
    $(guidesIndex.bind);
  </script>
</body>
</html>
